import React, { useState } from 'react';
import { Star, Trophy, Award, RefreshCw } from 'lucide-react';

const wordBank = [
  { word: 'APPLE', hint: 'ë¹¨ê°„ìƒ‰ì´ë‚˜ ì´ˆë¡ìƒ‰ ê³¼ì¼' },
  { word: 'BANANA', hint: 'ë…¸ë€ìƒ‰ ê¸¸ì­‰í•œ ê³¼ì¼' },
  { word: 'CAT', hint: 'ì•¼ì˜¹í•˜ëŠ” ë™ë¬¼' },
  { word: 'DOG', hint: 'ë©ë©í•˜ëŠ” ë™ë¬¼' },
  { word: 'BOOK', hint: 'ì½ëŠ” ê²ƒ' },
  { word: 'PENCIL', hint: 'ì“°ê³  ê·¸ë¦¬ëŠ” ë„êµ¬' },
  { word: 'SUN', hint: 'í•˜ëŠ˜ì˜ ë°ì€ ë³„' },
  { word: 'MOON', hint: 'ë°¤ì— ë³´ì´ëŠ” ê²ƒ' },
  { word: 'FISH', hint: 'ë¬¼ì— ì‚¬ëŠ” ë™ë¬¼' },
  { word: 'BIRD', hint: 'í•˜ëŠ˜ì„ ë‚˜ëŠ” ë™ë¬¼' },
  { word: 'TREE', hint: 'ë‚˜ë¬´' },
  { word: 'FLOWER', hint: 'ì˜ˆìœ ê½ƒ' },
  { word: 'HOUSE', hint: 'ì‚¬ëŒë“¤ì´ ì‚¬ëŠ” ê³³' },
  { word: 'RABBIT', hint: 'ê¹¡ì¶©ê¹¡ì¶© ë›°ëŠ” ë™ë¬¼' }
];

export default function KidsEnglishGame() {
  const [gameMode, setGameMode] = useState('menu');
  const [score, setScore] = useState(0);
  const [level, setLevel] = useState(1);
  const [stars, setStars] = useState(0);
  const [currentWord, setCurrentWord] = useState(wordBank[0]);
  const [guessedLetters, setGuessedLetters] = useState([]);
  const [wrongGuesses, setWrongGuesses] = useState(0);
  const [showHint, setShowHint] = useState(false);
  const [showResult, setShowResult] = useState(false);
  const [lastResult, setLastResult] = useState({ won: false, points: 0 });
  const [selectedCards, setSelectedCards] = useState([]);
  const [matchedCards, setMatchedCards] = useState([]);
  const [attempts, setAttempts] = useState(0);
  const [cardData, setCardData] = useState([]);

  const startGame = (mode) => {
    const randomWord = wordBank[Math.floor(Math.random() * wordBank.length)];
    setGameMode(mode);
    setCurrentWord(randomWord);
    setGuessedLetters([]);
    setWrongGuesses(0);
    setShowHint(false);
    setShowResult(false);
    setSelectedCards([]);
    setMatchedCards([]);
    setAttempts(0);
  };

  const handleGameEnd = (won, points) => {
    setLastResult({ won, points });
    setShowResult(true);
    if (won) {
      setScore(score + points);
      const newStars = stars + 1;
      setStars(newStars);
      if (newStars % 5 === 0) {
        setLevel(level + 1);
      }
    }
  };

  const nextRound = () => {
    const randomWord = wordBank[Math.floor(Math.random() * wordBank.length)];
    setCurrentWord(randomWord);
    setGuessedLetters([]);
    setWrongGuesses(0);
    setShowHint(false);
    setShowResult(false);
    setSelectedCards([]);
    setMatchedCards([]);
    setAttempts(0);
  };

  const HangmanGame = () => {
    const word = currentWord.word;
    const displayWord = word.split('').map(letter => 
      guessedLetters.includes(letter) ? letter : '_'
    ).join(' ');

    const handleGuess = (letter) => {
      if (guessedLetters.includes(letter)) return;
      
      const newGuessed = [...guessedLetters, letter];
      setGuessedLetters(newGuessed);
      
      if (!word.includes(letter)) {
        const newWrong = wrongGuesses + 1;
        setWrongGuesses(newWrong);
        if (newWrong >= 6) {
          setTimeout(() => handleGameEnd(false, 0), 500);
        }
      } else {
        const isComplete = word.split('').every(l => newGuessed.includes(l));
        if (isComplete) {
          const points = Math.max(100 - (wrongGuesses * 15) - (newGuessed.length * 2), 10);
          setTimeout(() => handleGameEnd(true, points), 500);
        }
      }
    };

    const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');

    return (
      <div className="text-center space-y-6">
        <div className="text-6xl mb-4">ğŸˆ</div>
        <div className="text-lg text-purple-600 mb-2">íŒíŠ¸: {currentWord.hint}</div>
        <div className="text-4xl font-bold text-gray-800 tracking-wider mb-4 font-mono">{displayWord}</div>
        <div className="text-xl text-red-500 font-bold">ì‹¤ìˆ˜: {wrongGuesses} / 6</div>
        <div className="flex flex-wrap gap-2 justify-center max-w-2xl mx-auto">
          {alphabet.map(letter => (
            <button
              key={letter}
              onClick={() => handleGuess(letter)}
              disabled={guessedLetters.includes(letter)}
              className={`w-12 h-12 rounded-lg font-bold text-lg transition-all ${
                guessedLetters.includes(letter)
                  ? word.includes(letter)
                    ? 'bg-green-400 text-white'
                    : 'bg-red-400 text-white'
                  : 'bg-gradient-to-br from-yellow-200 to-yellow-300 hover:from-yellow-300 hover:to-yellow-400 text-gray-800'
              }`}
            >
              {letter}
            </button>
          ))}
        </div>
      </div>
    );
  };

  const SpellingGame = () => {
    const [input, setInput] = useState('');

    const handleSubmit = () => {
      if (input.toUpperCase() === currentWord.word) {
        const points = showHint ? 80 : 150;
        handleGameEnd(true, points);
      } else {
        setInput('');
        setShowHint(true);
      }
    };

    return (
      <div className="text-center space-y-6">
        <div className="text-6xl mb-4">âœï¸</div>
        <div className="text-2xl font-bold text-purple-700 mb-4">ì´ ë‹¨ì–´ë¥¼ ì˜ì–´ë¡œ ì¨ë³´ì„¸ìš”!</div>
        <div className="text-xl text-gray-700 mb-2">íŒíŠ¸: {currentWord.hint}</div>
        {showHint && (
          <div className="text-lg text-orange-600 font-bold animate-bounce">
            ğŸ’¡ í‹€ë ¸ì–´ìš”! ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”!
          </div>
        )}
        <input
          type="text"
          value={input}
          onChange={(e) => setInput(e.target.value)}
          onKeyPress={(e) => e.key === 'Enter' && handleSubmit()}
          className="text-3xl font-bold text-center border-4 border-purple-300 rounded-xl p-4 w-64 focus:outline-none focus:border-purple-500 uppercase"
          placeholder="ë‹¨ì–´ ì…ë ¥"
          autoFocus
        />
        <br />
        <button
          onClick={handleSubmit}
          className="bg-gradient-to-r from-green-400 to-blue-400 text-white px-8 py-4 rounded-xl text-xl font-bold hover:from-green-500 hover:to-blue-500"
        >
          í™•ì¸í•˜ê¸° âœ“
        </button>
      </div>
    );
  };

  const MatchingGame = () => {
    const gameWords = wordBank.slice(0, 4);
    
    if (cardData.length === 0) {
      const cards = [
        ...gameWords.map((w, i) => ({ id: `word-${i}`, content: w.word, type: 'word', pair: i })),
        ...gameWords.map((w, i) => ({ id: `hint-${i}`, content: w.hint, type: 'hint', pair: i }))
      ].sort(() => Math.random() - 0.5);
      setCardData(cards);
    }

    const handleClick = (card) => {
      if (selectedCards.length === 2 || matchedCards.includes(card.id) || selectedCards.includes(card.id)) return;

      const newSelected = [...selectedCards, card.id];
      setSelectedCards(newSelected);

      if (newSelected.length === 2) {
        const newAttempts = attempts + 1;
        setAttempts(newAttempts);
        
        const [first, second] = newSelected.map(id => cardData.find(c => c.id === id));
        
        if (first.pair === second.pair && first.type !== second.type) {
          const newMatched = [...matchedCards, ...newSelected];
          setMatchedCards(newMatched);
          setSelectedCards([]);
          
          if (newMatched.length === cardData.length) {
            const points = Math.max(200 - (newAttempts * 10), 50);
            setTimeout(() => handleGameEnd(true, points), 500);
          }
        } else {
          setTimeout(() => setSelectedCards([]), 800);
        }
      }
    };

    return (
      <div className="text-center space-y-6">
        <div className="text-6xl mb-4">ğŸ¯</div>
        <div className="text-xl font-bold text-purple-700">ì˜ì–´ ë‹¨ì–´ì™€ ëœ»ì„ ì—°ê²°í•˜ì„¸ìš”!</div>
        <div className="text-lg text-gray-600 mt-2">ì‹œë„ íšŸìˆ˜: {attempts}</div>
        <div className="grid grid-cols-4 gap-3 max-w-3xl mx-auto">
          {cardData.map(card => (
            <button
              key={card.id}
              onClick={() => handleClick(card)}
              className={`p-4 rounded-xl font-bold text-sm h-24 transition-all ${
                matchedCards.includes(card.id)
                  ? 'bg-gradient-to-br from-green-300 to-green-400 text-white'
                  : selectedCards.includes(card.id)
                  ? 'bg-gradient-to-br from-blue-300 to-blue-400 text-white'
                  : 'bg-gradient-to-br from-pink-200 to-purple-200 text-gray-800 hover:from-pink-300 hover:to-purple-300'
              }`}
            >
              {card.content}
            </button>
          ))}
        </div>
      </div>
    );
  };

  if (gameMode === 'menu') {
    return (
      <div className="min-h-screen bg-gradient-to-br from-pink-200 via-purple-200 to-blue-200 p-8">
        <div className="max-w-4xl mx-auto">
          <div className="text-center mb-12 animate-bounce">
            <h1 className="text-6xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-pink-600 mb-4">
              ğŸŒŸ ì˜ì–´ ë‹¨ì–´ ê²Œì„ ğŸŒŸ
            </h1>
            <p className="text-2xl text-gray-700">ì¬ë¯¸ìˆê²Œ ì˜ì–´ë¥¼ ë°°ì›Œìš”!</p>
          </div>

          <div className="bg-white rounded-3xl shadow-2xl p-8 mb-8">
            <div className="flex justify-around text-center mb-8 flex-wrap gap-4">
              <div className="bg-gradient-to-br from-yellow-200 to-yellow-300 rounded-2xl p-6 shadow-lg">
                <Trophy className="mx-auto mb-2 text-yellow-600" size={40} />
                <div className="text-3xl font-bold text-yellow-700">{score}</div>
                <div className="text-sm text-gray-600">ì ìˆ˜</div>
              </div>
              <div className="bg-gradient-to-br from-purple-200 to-purple-300 rounded-2xl p-6 shadow-lg">
                <Award className="mx-auto mb-2 text-purple-600" size={40} />
                <div className="text-3xl font-bold text-purple-700">{level}</div>
                <div className="text-sm text-gray-600">ë ˆë²¨</div>
              </div>
              <div className="bg-gradient-to-br from-pink-200 to-pink-300 rounded-2xl p-6 shadow-lg">
                <Star className="mx-auto mb-2 text-pink-600" size={40} />
                <div className="text-3xl font-bold text-pink-700">{stars}</div>
                <div className="text-sm text-gray-600">ë³„</div>
              </div>
            </div>

            <div className="grid md:grid-cols-3 gap-6">
              <button
                onClick={() => startGame('hangman')}
                className="bg-gradient-to-br from-blue-300 to-blue-400 hover:from-blue-400 hover:to-blue-500 text-white rounded-2xl p-8"
              >
                <div className="text-6xl mb-4">ğŸˆ</div>
                <div className="text-2xl font-bold">í–‰ë§¨ ê²Œì„</div>
                <div className="text-sm mt-2">ê¸€ìë¥¼ ë§ì¶°ë³´ì„¸ìš”!</div>
              </button>

              <button
                onClick={() => startGame('spelling')}
                className="bg-gradient-to-br from-green-300 to-green-400 hover:from-green-400 hover:to-green-500 text-white rounded-2xl p-8"
              >
                <div className="text-6xl mb-4">âœï¸</div>
                <div className="text-2xl font-bold">ìŠ¤í ë§ ê²Œì„</div>
                <div className="text-sm mt-2">ë‹¨ì–´ë¥¼ ì¨ë³´ì„¸ìš”!</div>
              </button>

              <button
                onClick={() => startGame('matching')}
                className="bg-gradient-to-br from-pink-300 to-pink-400 hover:from-pink-400 hover:to-pink-500 text-white rounded-2xl p-8"
              >
                <div className="text-6xl mb-4">ğŸ¯</div>
                <div className="text-2xl font-bold">ë§¤ì¹­ ê²Œì„</div>
                <div className="text-sm mt-2">ì§ì„ ì°¾ì•„ë³´ì„¸ìš”!</div>
              </button>
            </div>
          </div>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-pink-200 via-purple-200 to-blue-200 p-8">
      <div className="max-w-4xl mx-auto">
        <div className="flex justify-between items-center mb-8 flex-wrap gap-4">
          <button
            onClick={() => setGameMode('menu')}
            className="bg-white text-gray-700 px-6 py-3 rounded-xl font-bold hover:bg-gray-100"
          >
            â† ë©”ë‰´ë¡œ
          </button>
          <div className="flex gap-4">
            <div className="bg-white px-6 py-3 rounded-xl font-bold shadow-lg flex items-center gap-2">
              <Trophy className="text-yellow-500" size={24} />
              {score}
            </div>
            <div className="bg-white px-6 py-3 rounded-xl font-bold shadow-lg flex items-center gap-2">
              <Star className="text-pink-500" size={24} />
              {stars}
            </div>
          </div>
        </div>

        <div className="bg-white rounded-3xl shadow-2xl p-8">
          {showResult ? (
            <div className="text-center space-y-6 py-12">
              <div className="text-8xl mb-4">{lastResult.won ? 'ğŸ‰' : 'ğŸ˜¢'}</div>
              <div className="text-4xl font-bold text-gray-800 mb-4">
                {lastResult.won ? 'ì •ë‹µì´ì—ìš”!' : 'ì•„ì‰¬ì›Œìš”!'}
              </div>
              {lastResult.won && (
                <div className="text-2xl text-purple-600 font-bold">+{lastResult.points} ì !</div>
              )}
              <div className="text-xl text-gray-600 mb-4">
                ì •ë‹µ: <span className="font-bold text-green-600">{currentWord.word}</span>
              </div>
              <div className="flex gap-4 justify-center flex-wrap">
                <button
                  onClick={nextRound}
                  className="bg-gradient-to-r from-green-400 to-blue-400 text-white px-8 py-4 rounded-xl text-xl font-bold hover:from-green-500 hover:to-blue-500 flex items-center gap-2"
                >
                  <RefreshCw size={24} />
                  ë‹¤ìŒ ë¬¸ì œ
                </button>
                <button
                  onClick={() => setGameMode('menu')}
                  className="bg-gradient-to-r from-purple-400 to-pink-400 text-white px-8 py-4 rounded-xl text-xl font-bold hover:from-purple-500 hover:to-pink-500"
                >
                  ë©”ë‰´ë¡œ ê°€ê¸°
                </button>
              </div>
            </div>
          ) : (
            <>
              {gameMode === 'hangman' && <HangmanGame />}
              {gameMode === 'spelling' && <SpellingGame />}
              {gameMode === 'matching' && <MatchingGame />}
            </>
          )}
        </div>
      </div>
    </div>
  );
}
